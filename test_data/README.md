<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Test data](#test-data)
  - [Generating data](#generating-data)
  - [Domain directories](#domain-directories)
  - [Domain YAML file](#domain-yaml-file)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Test data

This directory contains data to be used by the tests in `../autotest`. The
`generate/` directory generates test data not included in the repository
but which are critical to the autotests.

## Generating data

In the `generate/` subdirectory, the following commands generate necessary
test data

```shell
pytest -v -n=auto run_prms_domains.py
pytest -v -n=auto convert_prms_output_to_nc.py
```

The first command uses binaries which come with pywatershed to execute
reference models, specifically the PRMS v5.2.1 binary. All
domains included in the the 'test_data/' directory will be run with
the binary and the output generated by the binary becomes test answers/
reference data for pytest autotests. 


It is possible that the included binaries will not work on your system.
For a failing PRMS 5.2.1 binary, please see [`prms_src/prms5.2.1/README.md`](../prms_src/prms5.2.1/README.md).
If you compile yourself, you'll need to copy `prms_src/prms5.2.1/bin/prms`
to `bin/` while renaming it to one of the existing files found therein.
Currently, supplied binaries are all compiled with gfortran except on
Mac ARM architecture where ifort is used.

After successfully running the domains, the second command converts the
output from all domains to NetCDF files. This step also produces NetCDF
files for variables derived from run outputs. 

Behind the scenes, these pytest commands manage the file in the
`test_data/.test_data_made_by_version.txt `. This is meant to be a copy of the
`version.txt` file from the root of the repository. It's existence and matching
contents are required to not throw an immediate error when running tests in
the `autotest/` directory. There are temporarysituations where such errors are
unwarranted and in those cases, disabling the errors by editing
`autotest/conftest.py` is the temporary solution.

## Domain directories

Additional domains may be supplied by the user for autotesting by
pywatershed. Also note that evaluation of pywatershed against PRMS in
the notebook `examples/03_compare_pws_prms.ipynb` uses this approach
as well. To supply your own domain, you must generate the required
files in `test_data/your_domain` given in this listing:

```
control.test  prcp.cbh      sf_data       tmax.nc       tmin.nc
myparam.param prcp.nc       tmax.cbh      tmin.cbh
```

The `*.cbh` files must be pre-converted to netcdf for `prcp`, `tmin`,
and `tmax`. How to do this can be found near the top of notebook
`examples/02_prms_legacy_models.ipynb`. The `control.test` and
`myparam.param` files are used by both PRMS and PWS. The `control.test`
files in the repository are specific for being able to run sub-models in
pywatershed and include a nearly maximal amount of model output
(time-inefficient for both PRMS and PWS but necessary or pywatershed
autotests). The stock control files can be found in `test_data/common`.
There is a file for single-HRU domains and multi-HRU domains and these
are identical (as appropriate) for the domains included in the
repository.

## Domain YAML file
The contents of the `domain/domain.yaml` file is described in the
[`autotest/README.md`](../autotest/README.md)